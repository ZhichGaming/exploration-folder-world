<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/loaders/RGBELoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/pmrem/PMREMGenerator.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/geometries/RoundedBoxGeometry.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/loaders/GLTFLoader.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      /* background-color: #f0f0f0; */ /* Apparently -1 z-index puts the element beneath the body */
      font-family: 'Space Grotesk', sans-serif;
    }

    p {
      margin: 0;
    }

    .start-container {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .start-cover {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: #f0f0f0; 
    }

    .circle-container {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .circle {
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      position: absolute;
      width: 0;
      height: 0;
      border-radius: 50%;
      background-color: white;
      animation: circleExpand 1s ease-out forwards;
    }

    .dissappearing-circle {
      animation: circleDissappear 0.5s ease-out forwards;
    }

    .hidden {
      display: none;
      visibility: hidden;
    }

    .hidden-button {
      display: none;
      transform: scale(0);
    }

    .shown-button {
      display: block;
      animation: buttonExpand 1s ease-out;
    }

    .expanding-button {
      animation: buttonDissappearExpand 1s ease-out forwards;
    }

    .dissappearing-button {
      animation: buttonDissappear 1s ease-out forwards;
    }

    .start-button {
      position: absolute;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(2,0,36,1) 0%, rgba(190,34,34,1) 95%);
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }

    .start-button:hover {
      transform: scale(1.1);
    }

    .main-canvas {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: -1;
    }

    .main-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 1;
      pointer-events: none;
      text-align: center;
    }
    
    .title {
      color: white;
      font-size: 6em;
      text-align: center;
      font-family: "Playfair Display", serif;
      font-optical-sizing: auto;
      font-weight: 400;
      font-style: normal;
      margin: 0;
    }

    .underline-hr {
      width: 20%;
      border: 0;
      border-top: 1px solid white;
    }

    .country-title {
      margin-top: 20px;
    }

    .click-to-enter {
      height: 50px;
      margin-bottom: 20px;
    }

    .white-text {
      color: white;
    }

    .caret {
      margin-top: 5px;
      animation: floating 2s ease-in-out infinite;
    }

    @keyframes circleExpand {
      0% {
        width: 0;
        height: 0;
        opacity: 0;
      }
      50% {
        opacity: 1;
      }
      75% {
        width: 200px;
        height: 200px;
      }
      100% {
        width: 150px;
        height: 150px;
      }
    }

    @keyframes circleDissappear {
      0% {
        transform: scale(1);
      }
      100% {
        transform: scale(0);
      }
    }

    @keyframes buttonExpand {
      0% {
        transform: scale(0);
      }
      100% {
        transform: scale(1);
      }
    }

    @keyframes buttonDissappearExpand {
      0% {
        transform: scale(1);
      }
      100% {
        transform: scale(20);
        width: 100vw;
        height: 100vw;
      }
    }

    @keyframes buttonDissappear {
      0% {
        transform: scale(1);
      }
      100% {
        transform: scale(0);
        width: 0;
        height: 0;
      }
    }

    @keyframes appear {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }

    @keyframes floating {
      0% { transform: translateY(0); }
      50% { transform: translateY(5px); }
      100% { transform: translateY(0); }
    }
  </style>
</head>
<body>
  <script>
    let bgm = new Audio("https://files.catbox.moe/izl82x.mp3");
    bgm.loop = true;
    bgm.volume = 0.5;
  </script>
  <div id="start-container" class="start-container">
    <div id="start-cover" class="start-cover"></div>
    <div class="circle-container">
      <button id="animatedButton" class="start-button hidden-button"></button>
    </div>
  </div>
  <div class="hidden main-container white-text" id="main-container">
    <div class="country-title">
      <h1 class="title">Chine</h1>
      <hr class="underline-hr">
    </div>
    <div class="click-to-enter">
      <p>Cliquer pour entrer</p>
      <p class="caret">â–¼</p>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const container = document.querySelector(".circle-container");
      const circle = document.createElement("div");

      // Create a circle
      circle.classList.add("circle");
      circle.style.pointerEvents = "none";

      container.appendChild(circle);

      // After the circle expands, show the button
      circle.addEventListener("animationend", function() {
        var tag = document.createElement("p");
        var text = document.createTextNode("ENTRER");
        tag.appendChild(text);
        tag.style.opacity = 0;
        tag.style.animation = "appear 1s ease-out forwards";

        circle.appendChild(tag);

        const button = document.getElementById("animatedButton");
        button.classList.remove("hidden-button");
        button.classList.add("shown-button");

        button.addEventListener("onAnimationEnd", function() {
          button.classList.remove("shown-button");
        }, { once: true });

        button.addEventListener("click", function (){
          const startCoverElement = document.getElementById("start-container")
          // Expand the button, dissappear the cover
          button.classList.add("expanding-button")

          bgm.play();

          document.addEventListener("visibilitychange", () => {
          if (document.visibilityState === "visible") {
            bgm.play();
          } else {
            bgm.pause();
          }
        });

          button.addEventListener("animationend", function() {
            startCoverElement.classList.add("dissappearing-circle")
            
            document.getElementById("start-cover").classList.add("hidden")

            startCoverElement.addEventListener("animationend", function() {
              document.getElementById("main-container").classList.remove("hidden")

              button.classList.add("hidden")
              button.classList.remove("dissappearing-button")
            }, { once: true });
          }, { once: true });
        })
      }, { once: true }); // Match the animation duration
    });

    if (!window.WebGLRenderingContext) {
      alert('Your browser does not support WebGL');
    }
    // const canvasElement = document.getElementById("main-canvas");
    // canvasElement.width = window.innerWidth;
    // canvasElement.height = window.innerHeight;

    // Create the scene
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x100b0b);

    // Set up the camera
    const camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(5, 2, 0);

    // Create the renderer
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.shadowMap.enabled = true;
    renderer.domElement.classList.add("main-canvas")
    renderer.domElement.id = "main-canvas"
    document.body.appendChild(renderer.domElement);

    // Add orbit controls
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.1;

    // Add light (RandomizedLight equivalent)
    const light = new THREE.PointLight(0xadd8e6, 1, 100);
    light.position.set(-5, 5, 2);
    scene.add(light);

    // Add a light source
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5, 5, 5).normalize();
    scene.add(dirLight);

    // Create a rounded box geometry (RoundedBox equivalent)
    const cubeRadius = 1.5
    const roundedBoxGeometry = new THREE.RoundedBoxGeometry(cubeRadius, cubeRadius, cubeRadius, 10, 0.05);  // width, height, depth, segments, radius of corner curvature
    const roundedBoxMaterial = new THREE.MeshPhysicalMaterial({
      color: 0xffffff,            // Cube color
      roughness: 0,               // Smoothness of the surface
      metalness: 0.0,             // Non-metallic surface
      transmission: 1.0,          // Fully transparent like glass
      opacity: 0.5,               // Semi-transparent
      transparent: true,          // Allow transparency
      ior: 1.5,                   // Index of refraction (for glass-like effect)
      thickness: 0.2,             // Simulate glass thickness
    });

    const roundedBox = new THREE.Mesh(roundedBoxGeometry, roundedBoxMaterial);
    roundedBox.castShadow = true;
    scene.add(roundedBox);

    const glbLink = "https://files.catbox.moe/hatd9t.glb";
    const loader = new THREE.GLTFLoader();

    let mixer = undefined

    loader.load(glbLink, function(gltf) {
      const model = gltf.scene;
      const scale = 0.02
      model.scale.set(scale, scale, scale);
      model.position.set(0, 0.5, 0);

      // Create an AnimationMixer, and get the list of AnimationClip instances
      mixer = new THREE.AnimationMixer( model );

      // Play a specific animation
      const action = mixer.clipAction( gltf.animations[0], model );
      action.play();

      // Play all animations
      gltf.animations.forEach( function ( clip ) {
        mixer.clipAction( clip ).play();
      } );
      
      roundedBox.add(model);
    });

    // Environment map (HDR texture)
    const pmremGenerator = new THREE.PMREMGenerator(renderer);
    pmremGenerator.compileEquirectangularShader();

    new THREE.RGBELoader()
      .setPath('https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/')
      .load('dancing_hall_1k.hdr', function (texture) {
        const envMap = pmremGenerator.fromEquirectangular(texture).texture;
        scene.environment = envMap;
        texture.dispose();
        pmremGenerator.dispose();
      });

    // Accumulative Shadows simulation (light blue shadow)
    const shadowPlaneGeometry = new THREE.PlaneGeometry(10, 10);
    const shadowPlaneMaterial = new THREE.ShadowMaterial({ color: 0xadd8e6, opacity: 0.75 });
    const shadowPlane = new THREE.Mesh(shadowPlaneGeometry, shadowPlaneMaterial);
    shadowPlane.rotation.x = -Math.PI / 2;
    shadowPlane.position.y = -1;
    shadowPlane.receiveShadow = true;
    scene.add(shadowPlane);

    const clock = new THREE.Clock();

    // Render loop
    function animate() {
      requestAnimationFrame(animate);

      // Update controls
      controls.update();

      // Update animation
      mixer?.update( clock.getDelta() );

      // Rotate the box
      roundedBox.rotation.y = Math.sin(clock.getElapsedTime() * 1) * 0.1;
      roundedBox.position.y = Math.sin(clock.getElapsedTime() * 2) * 0.1;

      // Render the scene
      renderer.render(scene, camera);
    }

    animate();

    // Handle window resizing
    window.addEventListener('resize', () => {
      const width = window.innerWidth;
      const height = window.innerHeight;
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
      renderer.setSize(width, height);
    });
  </script>
</body>
</html>
